# ‚ö° –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã —Ä–µ–∑–µ—Ä–≤–∞

## ‚úÖ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

1. **–ù–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ –ë–î**: `ReservTimeSlot` –∏ `ReservBooking`
2. **–ü–∞—Ä—Å–µ—Ä**: –ü–∞—Ä—Å–∏—Ç –ª–∏—Å—Ç—ã "—Ä–µ–∑–µ—Ä–≤" –∏ "—Ñ–∏–Ω—Ñ–∞–∫" –∏–∑ Google Sheets
3. **–ö–æ–º–∞–Ω–¥–∞ `/parse_reserv`**: –î–µ—Ç–∞–ª—å–Ω—ã–π –¥–µ–±–∞–≥ –ø–∞—Ä—Å–∏–Ω–≥–∞ —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π

---

## üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ

### 1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é

```bash
cd /Users/katusha/Desktop/Shend

# –ï—Å–ª–∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –µ—â–µ –Ω–µ—Ç
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt

# –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
alembic revision --autogenerate -m "add reserv time slots and bookings"

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
alembic upgrade head
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ PostgreSQL –∑–∞–ø—É—â–µ–Ω

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞
brew services list | grep postgresql

# –ï—Å–ª–∏ –Ω–µ –∑–∞–ø—É—â–µ–Ω
brew services start postgresql@15

# –°–æ–∑–¥–∞—Ç—å –ë–î (–µ—Å–ª–∏ –µ—â–µ –Ω–µ—Ç)
PGPASSWORD='katusha123' psql -U katusha -d postgres -h localhost -c "CREATE DATABASE shend;"
```

### 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞

```bash
cd /Users/katusha/Desktop/Shend
source venv/bin/activate
python main.py
```

### 4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä—Å–∏–Ω–≥

–í Telegram –±–æ—Ç–µ (–æ—Ç –≤–∞—à–µ–≥–æ –∞–¥–º–∏–Ω—Å–∫–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞):
```
/parse_reserv
```

---

## üìã –ß—Ç–æ –ø–æ–∫–∞–∂–µ—Ç –∫–æ–º–∞–Ω–¥–∞ /parse_reserv

### –≠—Ç–∞–ø 1: –ü–∞—Ä—Å–∏–Ω–≥ Google Sheets
```
üîÑ –ù–∞—á–∏–Ω–∞—é –ø–∞—Ä—Å–∏–Ω–≥ —Ä–µ–∑–µ—Ä–≤–∞ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã...
üìã –¢–∞–±–ª–∏—Ü–∞: [—Å—Å—ã–ª–∫–∞]

============================================================
üìÑ –ü–∞—Ä—Å–∏–Ω–≥ –ª–∏—Å—Ç–∞: '—Ä–µ–∑–µ—Ä–≤'
üìÖ –î–∞—Ç–∞: 2025-11-05
üéì –î–ª—è —Ñ–∞–∫—É–ª—å—Ç–µ—Ç–∞: –í—Å–µ
============================================================

üìã –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ª–∏—Å—Ç–∞ (–ø–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞):
   –ö–æ–ª–æ–Ω–∫–∞ A: '–ò–º—è'
   –í—Ä–µ–º–µ–Ω–∞: 09:00 (9:00), 09:45 (9:45), 10:30 (10:30)...
   –ö–æ–ª–æ–Ω–∫–∞ T: 'ID'

üë• –ü–∞—Ä—Å–∏–Ω–≥ —Å—Ç—Ä–æ–∫ 2-25 (—Å–æ–±–µ—Å–µ–¥—É—é—â–∏–µ):

   ‚úÖ –°—Ç—Ä–æ–∫–∞ 2: –ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω (ID: iv001)
      –°–ª–æ—Ç–æ–≤: 5 | –í—Ä–µ–º–µ–Ω–∞: 09:00, 10:30, 14:15, 15:00, 16:30
   
   ‚úÖ –°—Ç—Ä–æ–∫–∞ 3: –ü–µ—Ç—Ä–æ–≤–∞ –ê–Ω–Ω–∞ (ID: pet02)
      –°–ª–æ—Ç–æ–≤: 3 | –í—Ä–µ–º–µ–Ω–∞: 12:00, 13:30, 18:00
   
   ‚ö†Ô∏è –°—Ç—Ä–æ–∫–∞ 4 ('–°–∏–¥–æ—Ä–æ–≤ –ü–µ—Ç—Ä'): –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤

üìä –ò—Ç–æ–≥–æ –ø–æ –ª–∏—Å—Ç—É '—Ä–µ–∑–µ—Ä–≤':
   ‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ: 8 —Å–æ–±–µ—Å–µ–¥—É—é—â–∏—Ö
   ‚ö†Ô∏è –ü—Ä–æ–ø—É—â–µ–Ω–æ: 12 —Å—Ç—Ä–æ–∫
   üì¶ –°–æ–∑–¥–∞–Ω–æ —Å–ª–æ—Ç–æ–≤: 45
```

### –≠—Ç–∞–ø 2: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î
```
‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ –∑–∞–≤–µ—Ä—à–µ–Ω!

üìä –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
‚Ä¢ –î–æ–±–∞–≤–ª–µ–Ω–æ –Ω–æ–≤—ã—Ö —Å–ª–æ—Ç–æ–≤: 45
‚Ä¢ –û–±–Ω–æ–≤–ª–µ–Ω–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö: 0
‚Ä¢ –ü—Ä–æ–ø—É—â–µ–Ω–æ (–∑–∞–Ω—è—Ç–æ –∏–ª–∏ –Ω–µ—Ç –≤ —Å–∏—Å—Ç–µ–º–µ): 8

üìã –í—Å–µ–≥–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ: 53 —Å–ª–æ—Ç–æ–≤ –∏–∑ Google Sheets
```

### –≠—Ç–∞–ø 3: –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
```
üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ü–û –°–û–ë–ï–°–ï–î–£–Æ–©–ò–ú

üë§ –ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω (ID: iv001)
   üì¶ –í—Å–µ–≥–æ —Å–ª–æ—Ç–æ–≤: 8
   üìÑ —Ä–µ–∑–µ—Ä–≤: 5 —Å–ª–æ—Ç–æ–≤
      ‚è∞ 09:00, 10:30, 14:15, 15:00, 16:30
   üìÑ —Ñ–∏–Ω—Ñ–∞–∫: 3 —Å–ª–æ—Ç–∞
      ‚è∞ 12:00, 13:30, 18:00

üë§ –ü–µ—Ç—Ä–æ–≤–∞ –ê–Ω–Ω–∞ (ID: pet02)
   üì¶ –í—Å–µ–≥–æ —Å–ª–æ—Ç–æ–≤: 6
   üìÑ —Ä–µ–∑–µ—Ä–≤: 4 —Å–ª–æ—Ç–∞
      ‚è∞ 11:15, 12:45, 16:30, 18:45
   üìÑ —Ñ–∏–Ω—Ñ–∞–∫: 2 —Å–ª–æ—Ç–∞
      ‚è∞ 14:15, 19:15
```

---

## üîç –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –ë–î

```bash
# –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ –ë–î
PGPASSWORD='katusha123' psql -U katusha -d shend -h localhost

-- –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–æ—Ç–æ–≤ –ø–æ –ª–∏—Å—Ç–∞–º
SELECT sheet_name, COUNT(*) 
FROM reserv_time_slots 
GROUP BY sheet_name;

-- –°–º–æ—Ç—Ä–∏–º –ø—Ä–∏–º–µ—Ä—ã —Å–ª–æ—Ç–æ–≤
SELECT 
    i.full_name,
    r.sheet_name,
    r.date,
    r.time_start,
    r.time_end,
    r.is_available
FROM reserv_time_slots r
JOIN interviewers i ON i.id = r.interviewer_id
ORDER BY r.date, r.time_start
LIMIT 10;

-- –í—ã—Ö–æ–¥–∏–º
\q
```

---

## ‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### "–ü—Ä–æ–ø—É—â–µ–Ω–æ: –≤—Å–µ —Å–æ–±–µ—Å–µ–¥—É—é—â–∏–µ"

**–ü—Ä–∏—á–∏–Ω–∞:** –°–æ–±–µ—Å–µ–¥—É—é—â–∏–µ –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ —Å–∏—Å—Ç–µ–º–µ.

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ ID –≤ –∫–æ–ª–æ–Ω–∫–µ T —Å–æ–≤–ø–∞–¥–∞—é—Ç —Å `interviewer_sheet_id` –≤ —Ç–∞–±–ª–∏—Ü–µ `interviewers`
2. –ï—Å–ª–∏ —Å–æ–±–µ—Å–µ–¥—É—é—â–∏—Ö –Ω–µ—Ç - –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –∏—Ö —á–µ—Ä–µ–∑ `/register_sobes`

```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–±–µ—Å–µ–¥—É—é—â–∏—Ö –≤ –ë–î
SELECT id, full_name, interviewer_sheet_id FROM interviewers;
```

### "–õ–∏—Å—Ç '—Ä–µ–∑–µ—Ä–≤' –Ω–µ –Ω–∞–π–¥–µ–Ω"

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ª–∏—Å—Ç–∞ –∏–ª–∏ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞.

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ª–∏—Å—Ç –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è **—Ç–æ—á–Ω–æ** "—Ä–µ–∑–µ—Ä–≤" (—Å –º–∞–ª–µ–Ω—å–∫–æ–π –±—É–∫–≤—ã)
2. –î–∞–π—Ç–µ –¥–æ—Å—Ç—É–ø –∫ —Ç–∞–±–ª–∏—Ü–µ email: `sha-bot-sobes@sha-otbor-476513.iam.gserviceaccount.com`

### "APIError: Quota exceeded"

**–ü—Ä–∏—á–∏–Ω–∞:** –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Google API.

**–†–µ—à–µ–Ω–∏–µ:** –ü–æ–¥–æ–∂–¥–∏—Ç–µ 1-2 –º–∏–Ω—É—Ç—ã –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ `/parse_reserv` —Å–Ω–æ–≤–∞.

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤

```
Shend/
‚îú‚îÄ‚îÄ db/
‚îÇ   ‚îî‚îÄ‚îÄ models.py                    # ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã ReservTimeSlot, ReservBooking
‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îî‚îÄ‚îÄ reserv_parser.py             # ‚úÖ –ù–û–í–´–ô - –ø–∞—Ä—Å–µ—Ä –¥–ª—è —Ä–µ–∑–µ—Ä–≤–∞
‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îî‚îÄ‚îÄ reserv_handlers.py           # ‚úÖ –ù–û–í–´–ô - –∫–æ–º–∞–Ω–¥–∞ /parse_reserv
‚îú‚îÄ‚îÄ main.py                          # ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω reserv_router
‚îú‚îÄ‚îÄ RESERV_MIGRATION_GUIDE.md        # ‚úÖ –ù–û–í–´–ô - –ø–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
‚îî‚îÄ‚îÄ QUICK_START_RESERV.md            # ‚úÖ –ù–û–í–´–ô - —ç—Ç–æ—Ç —Ñ–∞–π–ª
```

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:

1. **–ö–æ–º–∞–Ω–¥—É `/reserv`** - –∑–∞–ø–∏—Å—å –¥–ª—è –≤—Å–µ—Ö —Ñ–∞–∫—É–ª—å—Ç–µ—Ç–æ–≤ (–ª–∏—Å—Ç "—Ä–µ–∑–µ—Ä–≤")
2. **–ö–æ–º–∞–Ω–¥—É `/finfak`** - –∑–∞–ø–∏—Å—å —Ç–æ–ª—å–∫–æ –¥–ª—è –§–∏–Ω—Ñ–∞–∫–∞ (–ª–∏—Å—Ç "—Ñ–∏–Ω—Ñ–∞–∫")
3. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** —Å–æ–±–µ—Å–µ–¥—É—é—â–∏–º –æ –Ω–æ–≤—ã—Ö –∑–∞–ø–∏—Å—è—Ö
4. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É** –ø–æ –∑–∞–ø–∏—Å—è–º

---

**–ì–æ—Ç–æ–≤–æ! –°–∏—Å—Ç–µ–º–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç! üöÄ**

–î–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ —Å–º. `RESERV_MIGRATION_GUIDE.md`
